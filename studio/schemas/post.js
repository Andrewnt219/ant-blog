import client from "part:@sanity/base/client";

export default {
	name: "post",
	title: "Post",
	type: "document",

	initialValue: {
		isArchived: false,
		publishedAt: new Date().toISOString(),
		isPinned: false,
	},

	fields: [
		{
			name: "isPinned",
			title: "Pinned Post",
			type: "boolean",
			description: "Náº¿u báº­t thÃ¬ bÃ i post sáº½ lÃ  1 trong 3 táº¥m á»Ÿ Ä‘áº§u trang chá»§.",
			validation: (Rule) =>
				Rule.required().custom(() =>
					client
						.fetch(
							`
								*[_type == 'post' && isPinned].isPinned
							`
						)
						.then((post) =>
							post.length > 3
								? "Em pin tá»‘i Ä‘a 03 bÃ i thÃ´i nha, tham thÃ¬ thÃ¢m Ä‘Ã³ =))."
								: true
						)
				),
		},
		{
			name: "title",
			title: "Title",
			type: "string",
			validation: (Rule) => Rule.required().error("Em quÃªn Ä‘áº·t tá»±a nÃ¨."),
		},
		{
			name: "slug",
			title: "Slug",
			type: "slug",
			options: {
				source: "title",
				maxLength: 96,
			},
			validation: (Rule) =>
				Rule.required().error(
					"KhÃ´ng cÃ³ cÃ¡i nÃ y khÃ´ng láº¥y bÃ i Ä‘Æ°á»£c, áº¥n generate náº¿u lÆ°á»i type."
				),
		},
		{
			name: "snippet",
			title: "Content snippet",
			type: "text",
			description: "A short introduction about the post",
			validation: (Rule) => [
				Rule.required().error("VÃ¬ tÃ­nh tháº©m má»¹ cá»§a web, em nÃªn ghi cÃ¡i nÃ y."),
				Rule.max(150).warning("Ngáº¯n ngáº¯n thÃ´i em, 150 letters Ä‘á»• láº¡i."),
			],
			rows: 3,
		},
		{
			name: "author",
			title: "Author",
			type: "reference",
			to: { type: "author" },
			validation: (Rule) =>
				Rule.required().error(
					"Hey, Ä‘á»«ng ngáº¡i, cho má»i ngÆ°á»i biáº¿t ai Ä‘Ã£ viáº¿t bÃ y nÃ y."
				),
		},
		{
			name: "mainImage",
			title: "Main image",
			type: "image",
			options: {
				hotspot: true,
			},
			validation: (Rule) =>
				Rule.required().error(
					"Main image (thumbnail) nhÆ° avatar cá»§a bÃ i viáº¿t Ã¡, cÅ©ng lÃ  táº¥m hÃ¬nh Ä‘áº§u tiÃªn cá»§a bÃ i viáº¿t."
				),
		},
		{
			name: "categories",
			title: "Categories",
			type: "array",
			of: [{ type: "reference", to: { type: "category" } }],
			validation: (Rule) => [
				Rule.required()
					.min(1)
					.error(
						"Em nÃªn phÃ¢n loáº¡i, khÃ´ng cÃ³ Ã´ nÃ y nÃ³ xuáº¥t hiá»‡n undefined web cÃ³ sá»¥p rÃ¡ng chá»‹u =))."
					),
				Rule.unique().error(
					"Say hay lÃ  má»™t ngÃ y dÃ i? CÃ³ category bá»‹ trÃ¹ng nÃ¨."
				),
			],
			description: "Category xáº¿p Ä‘áº§u tiÃªn lÃ  category chÃ­nh, cÃ²n láº¡i lÃ  phá»¥.",
		},
		{
			name: "publishedAt",
			title: "Published at",
			type: "datetime",
			options: {
				dateFormat: "MMM DD YYYY",
			},
			validation: (Rule) => Rule.required().error("Em quÃªn Ä‘á»ƒ ngÃ y Ä‘Äƒng nÃ¨."),
			description: "Current time is generated by default.",
		},
		{
			name: "body",
			title: "Body",
			type: "blockContent",
			validation: (Rule) =>
				Rule.required().error(
					"Chá» chÃºt, bÃ i nÃ y lÃ  clickbait Ã ? Ná»™i dung bÃ i viáº¿t Ä‘Ã¢u rá»“i =))."
				),
		},
		{
			name: "isArchived",
			title: "Archived",
			type: "boolean",
			description:
				"An archived post will be removed from the site, but stay in the studio.",
			validation: (Rule) =>
				Rule.custom((isArchived, context) => {
					if (context.document.isPinned && isArchived) {
						return "Em thÃ¡o pin rá»“i hÃ£y archive nha.";
					}

					return true;
				}),
		},
	],

	preview: {
		select: {
			title: "title",
			author: "author.name",
			media: "mainImage",
			isPinned: "isPinned",
			isArchived: "isArchived",
		},
		prepare(selection) {
			const { author, isPinned, title, isArchived } = selection;

			let attributedTitle = title;

			if (isArchived) {
				attributedTitle = "ðŸ“¦ " + attributedTitle;
			}

			if (isPinned) {
				attributedTitle = "ðŸ“Œ " + attributedTitle;
			}

			return {
				...selection,
				title: attributedTitle,
				subtitle: author && `by ${author}`,
			};
		},
	},
};
